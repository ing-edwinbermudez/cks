# kube-bench

**Kube-bench** is an open-source tool designed to check whether your Kubernetes cluster configuration meets the security recommendations defined in the CIS Kubernetes Benchmark

## üîë Key Concepts

- **CIS Kubernetes Benchmark:** This is a set of best practices and recommendations developed by the Center for Internet Security (CIS) for securely configuring Kubernetes components (like the API server, controller manager, scheduler, etc.) and cluster nodes.

- **Auditing:** Kube-bench automates the process of auditing a Kubernetes cluster against these defined security controls.

## ‚öôÔ∏è How It Works

Kube-bench is usually run inside or against a Kubernetes cluster.

1. **Selection of Benchmark:** It automatically detects the version of Kubernetes running and selects the appropriate version of the CIS Benchmark to use (e.g., CIS Kubernetes Benchmark v1.23.0).

2. **Test Execution:** It runs a series of tests categorized by the component they are auditing (e.g., Master Node Security, Worker Node Security, etc.).

3. **Component Interaction:**
    - For Master/Control Plane tests, it checks configurations of components like kube-apiserver, etcd, kube-scheduler, and kube-controller-manager.

    - For Node/Worker tests, it checks components like kubelet and container runtime.

4. **Reporting:** It generates a report detailing which checks passed, failed, or needed manual investig.

## üèÉ Running Kube-bench

Kube-bench can be run in several ways:
- Standalone Binary: You can install the binary on a Linux server and run it directly against a cluster.

- Docker Container: It can be run as a Docker container, often mounting necessary host directories to read configuration files.

- Kubernetes Job: The most common way to run it is as a Kubernetes Job. This allows the tool to run a set of pods across the cluster nodes, which then self-terminate upon completion, gathering results from all nodes.

## üìù Typical OutputT

The output is structured and easy to read, highlighting three key statuses:

| **Status** | **Meaning** |
|-----------|-------------|
| **PASS**  | The configuration meets the CIS recommendation. |
| **FAIL**  | The configuration violates the CIS recommendation. This indicates a potential security issue. |
| **INFO**  | An informational check that doesn't have a pass/fail state. These are often used for checks that require manual inspection. |
| **WARN**  | A check that needs manual investigation or a specific setting to be confirmed. Similar to INFO, but usually for a more critical setting. |

## üõ†Ô∏è Install Kube-bench Using the Repository (Debian/Ubuntu)

The best way to ensure you have the latest version and manage dependencies easily on Debian-based systems (like Ubuntu) is to add the official repository from Aqua Security.

### Documentation

- https://github.com/aquasecurity/kube-bench


### üõ†Ô∏è Install Kube-bench Using the Repository (Debian/Ubuntu)
The best way to ensure you have the latest version and manage dependencies easily on Debian-based systems (like Ubuntu) is to add the official repository from Aqua Security.

**üì• 1. Add the Aqua Security Repository**

First, install the necessary tools to handle HTTPS repositories, and then add the GPG key for the repository.


```bash
# 1. Install dependencies
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl

# 2. Add the Aqua Security GPG Key
curl -s https://aquasecurity.github.io/kube-bench/apt/PublicKey | sudo apt-key add -

# 3. Add the repository to your sources list
echo "deb [arch=amd64] https://aquasecurity.github.io/kube-bench/apt/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/kube-bench.list
```

**üì¶ 2. Install Kube-bench**

Once the repository is configured, you can use the standard package manager to install Kube-bench.

```bash
# 1. Update the package list to include the new repository
sudo apt-get update

# 2. Install kube-bench
sudo apt-get install -y kube-bench
```

**‚úÖ 3. Validate the Installation**

Confirm that the installation was successful and verify the installed version.

```bash
# Validate the version
kube-bench version

# Run the benchmark
kube-bench run 

# Check for the test
kube-bench --check="1.3.1"
kube-bench run --targets="master,etcd"
````

**Install manually**

```bash
# Download the package
curl -L https://github.com/aquasecurity/kube-bench/releases/download/v0.12.0/kube-bench_0.12.0_linux_amd64.deb -o kube-bench_0.12.0_linux_amd64.deb

# Install kube-bench
sudo dpkg -i kube-bench_0.12.0_linux_amd64.deb

# Validate of the version
kube-bench version
```